# 📈 한국투자증권 체결 및 수익률 디스코드 알림 봇

한국투자증권(OpenAPI)과 디스코드 웹훅을 연동하여
- 매수/매도 **체결 알림**
- 보유 종목의 **수익률 및 수익금 리포트**
를 **디스코드 채널로 실시간 전송**하는 Python 기반 자동화 봇입니다.

---

## ✅ 기능 요약

- 한국투자증권 체결 내역 조회 (REST API 기반)
- 보유 종목 평가금액 및 수익률 자동 계산
- 디스코드 채널로 알림 전송 (체결 / 수익률 / 시작 / 종료 / 예외)
- `.env` 파일을 활용한 민감 정보 안전 관리
- `schedule` 라이브러리를 활용한 주기적 실행 자동화
- Redis 기반 캐시로 토큰 재사용 및 중복 알림 방지

---

## 📦 설치 및 실행 방법

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. `.env` 파일 작성

루트 디렉터리에 `.env` 파일을 생성하고 다음 값을 입력합니다:
```env
KIS_APP_KEY=your_kis_app_key
KIS_APP_SECRET=your_kis_app_secret
KIS_ACCOUNT_NO=12345678-01
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/your_webhook
REDIS_URL=redis://localhost:6379
```
- `KIS_APP_KEY`, `KIS_APP_SECRET`: 한국투자증권 API 키 (실전용 또는 모의투자용)
- `KIS_ACCOUNT_NO`: `계좌번호-상품코드` 형식 (예: `12345678-01`)
- `DISCORD_WEBHOOK_URL`: 디스코드 웹훅 주소
- `REDIS_URL`: Redis 접속 주소

### 3. `.gitignore` 설정

`.env` 파일이 GitHub에 업로드되지 않도록 `.gitignore`에 다음을 추가합니다:
```
.env
__pycache__/
```

### 4. 실행
```bash
python kis_discord_alert.py
```

---

## ⏱ 동작 스케줄

- **체결 내역 확인**: 3분 간격
- **수익률 및 수익금 리포트 전송**: 2시간 간격
- **장중 시간(평일 08:00 ~ 16:00)** 동안에만 자동 실행
- 봇 시작 및 종료 시 디스코드에 상태 메시지 전송

---

## 📝 메시지 예시

### 체결 알림
```
[매수 체결 알림]
종목명: 삼성전자
수량: 10주
단가: 72,000원
```

### 수익률 리포트
```
📊 [보유 종목 수익률 보고]
삼성전자 | 평가금액: 1,020,000원 | 수익금: +20,000원 | 수익률: 2.00%
네이버 | 평가금액: 950,000원 | 수익금: -50,000원 | 수익률: -5.00%

📈 총 평가금액: 1,970,000원
💰 총 수익금: -30,000원
```

### 봇 상태 메시지
```
✅ 디스코드 체결/수익률 알림 봇이 시작되었습니다.
🛑 디스코드 체결/수익률 알림 봇이 종료되었습니다.
❌ 알림 봇 실행 중 예외 발생: ...
```

---

## ⚠️ 주의사항

- 한국투자증권 API를 사용하려면 **사전 신청** 및 **앱 등록**이 필요합니다.
- 체결 알림은 REST 방식(폴링)으로 구현되어 있으며, 웹소켓 방식의 실시간 알림은 제공하지 않습니다.
- 본 코드는 **실전 계좌용 API** (`tr_id`: `TTTC8001R`, `TTTC8434R`) 기준으로 작성되었으며, 모의 계좌의 경우 별도 설정이 필요합니다.
- Redis를 활용하여 토큰 재사용 및 중복 체결 알림을 방지합니다.

---

## 🛠 기술 스택

- Python
- requests
- schedule
- redis
- python-dotenv
- pytz
- Discord Webhook
- 한국투자증권 OpenAPI (REST)

---

## 📌 향후 개선 방향

- 웹소켓 기반 실시간 체결 감지 기능 추가 (API 제공 시)
- 텔레그램 / 슬랙 등 다양한 알림 채널 연동
- Flask 기반 대시보드 및 Docker 배포 자동화
- 주간/월간 수익률 요약 리포트 기능 추가

