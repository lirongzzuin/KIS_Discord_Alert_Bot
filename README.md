# 한국투자증권 체결 및 수익률 알림 자동화 봇 (Discord & Telegram 연동)

한국투자증권 OpenAPI를 활용하여 체결 알림, 수익률 리포트, 실현손익, 기관/외인 수급 정보까지 종합적으로 자동 전송하는 Python 기반 자동화 시스템입니다.

---

## 주요 기능

* **체결 알림**: 보유 종목의 매수/매도 체결 여부를 자동 감지하여 알림 전송
* **수익률 리포트**: 보유 종목 수익률, 수익금, 수급 정보 요약 리포트 자동 전송
* **누적 실현손익 리포트**: 2025년 기준 누적 수익률과 실현 손익 데이터를 API 기반으로 조회하여 리포트에 포함
* **텔레그램 알림 연동**: 디스코드 외에도 Telegram 채널에 동일한 리포트를 전송
* **중복 전송 방지**: Redis를 이용한 마지막 보유 종목 정보 캐싱으로 중복 감지 및 필터링
* **정시 리포트 및 실시간 감지 병행**: 매 2시간마다 정기 리포트 + 실시간 감지 기능 통합 운영
* **자동 시작/종료/오류 알림**: 실행 상태를 알리는 메시지가 자동 전송됨

---

## 설치 및 실행 방법

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. `.env` 파일 생성

루트 디렉터리에 `.env` 파일을 생성하고 아래 항목을 작성합니다:

```env
KIS_APP_KEY=your_kis_app_key
KIS_APP_SECRET=your_kis_app_secret
KIS_ACCOUNT_NO=12345678-01
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/your_webhook
REDIS_URL=redis://localhost:6379
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_CHAT_ID=your_telegram_chat_id
```

> **주의**: `.env`는 `.gitignore`에 반드시 추가하여 GitHub에 업로드되지 않도록 해야 합니다.

### 3. 실행

```bash
python kis_discord_alert.py
```

---

## 작동 스케줄

* **체결 감지**: 평일 09:00 \~ 15:00, 1분 간격 실시간 감지
* **정기 리포트**: 하루 4회 (08:30, 09:30, 13:30, 15:30)
* **누적 리포트**: 매일 16:00, 2025년 기준 누적 수익률/수익금 포함
* **상태 메시지 전송**: 봇 시작/종료/오류 발생 시 즉시 알림 전송

---

## 메시지 예시

### 체결 알림

```
[매수 체결 알림]
종목명: 삼성전자
수량: 10주
단가: 72,000원
```

### 수익률 및 수급 리포트

```
📊 [보유 종목 수익률 + 수급 요약 보고]
📌 삼성전자
┗ 수량: 10주 | 평균단가: 72,000원 | 현재가: 74,500원
┗ 평가금액: 745,000원 | 수익금: +25,000원 | 수익률: 3.47%
┗ 외국인: 🟢 매수 +15,000주 | 기관: 🔴 매도 -3,200주

📈 총 평가금액: 3,920,000원
💰 총 수익금: +120,000원
📉 총 수익률: 3.16%
```

### 누적 실현손익 리포트

```
📅 [2025 누적 리포트]
💵 실현 수익금: 3,240,000원
📈 누적 수익률: 7.84%
```

---

## 기술 스택 및 구조

* **언어**: Python 3.10+
* **라이브러리**: `requests`, `schedule`, `redis`, `python-dotenv`, `pytz`
* **API 연동**:

  * 실현손익 조회 API: `TTTC8494R`
  * 누적 손익 리포트 API: `TTTC8715R`
  * 보유 종목 수익률: `TTTC8434R`
  * 수급 정보 조회: `FHKST01010900`

---

## 주의 사항

* 한국투자증권 API는 사전 신청 및 인증이 필요합니다 ([https://apiportal.koreainvestment.com/](https://apiportal.koreainvestment.com/))
* 본 코드는 실전 계좌 기준으로 설계되었으며, 모의투자는 별도 키 발급 필요
* Redis 미설치 시 일부 기능(캐싱 및 중복 방지 등)이 제한될 수 있습니다
* 텔레그램 채널은 사전 봇 생성 및 chat\_id 확인 필요
* 공휴일은 내부 리스트에 하드코딩되어 있으며, 필요 시 수정

---

## 향후 개선 방향

* 웹소켓 기반 실시간 체결 알림으로 전환
* Slack 등 다른 메시징 플랫폼 연동 기능 추가
* Flask 기반 대시보드 및 REST API 제공
* 주간/월간/연간 리포트 기능 강화
* 투자 종목 추천, 기술적 분석 통계 리포트 자동화

---

## 라이선스 및 사용 조건

본 프로젝트의 모든 소스코드와 문서에 대한 저작권은 **해당 프로젝트 개발자**에게 있으며, 사용자는 다음 조건을 준수해야 합니다:

* 누구나 사용 및 수정 가능
* 단, 본 코드를 사용하는 경우 반드시 출처를 밝혀야 하며, 파생된 결과물은 **같은 라이선스로 공개**해야 합니다 (공유Alike 조건)
* 무단 상업적 이용은 금지되며, 별도 협의가 필요합니다

Copyright © 2025 Younggyun Lee. All rights reserved.